os: linux
dist: bionic
sudo: false
group: travis_latest
language: c++
cache: ccache

addons:
  apt:
  sources:
  - sourceline: 'deb https://apt.kitware.com/ubuntu/ bionic main'
      key_url: 'https://apt.kitware.com/keys/kitware-archive-latest.asc'
  packages:
  - cmake

matrix:
  include:

    - os: linux
      env: COMPILER=g++-8
      compiler: gcc
      addons: { apt: { packages: ["g++-8"], sources: ["ubuntu-toolchain-r-test"] } }

    - os: linux
      env: COMPILER=g++-9
      compiler: gcc
      addons: { apt: { packages: ["g++-9"], sources: ["ubuntu-toolchain-r-test"] } }

    - os: linux
      env: COMPILER=clang++-8
      compiler: clang
      addons: { apt: { packages: ["clang-8"], sources: ["ubuntu-toolchain-r-test", "llvm-toolchain-bionic-8"] } }

    - os: linux
      env: COMPILER=clang++-9
      compiler: clang
      addons: { apt: { packages: ["clang-9"], sources: ["ubuntu-toolchain-r-test", "llvm-toolchain-bionic-9"] } }

    - os: osx
      osx_image: xcode10.3
      env: COMPILER='clang++'
      compiler: clang

    - os: osx
      osx_image: xcode11.2
      env: COMPILER='clang++'
      compiler: clang

  fast_finish: true

script:
  - export CXX=${COMPILER}
  - JOBS=2 # Travis machines have 2 cores.
  - mkdir build && cd build
  - cmake -G "Unix Makefiles" -DGSL_LITE_OPT_BUILD_TESTS=ON -DGSL_LITE_OPT_BUILD_EXAMPLES=ON ..
  - cmake --build . -- -j${JOBS}
  - ctest --output-on-failure -j${JOBS}
