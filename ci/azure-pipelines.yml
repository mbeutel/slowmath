# Azure Pipelines configuration

variables:
  system.debug: true
  vcpkgGitRef: e308474b85ff49f2b688a759351c4ec569636910
  vcpkgPortsOverlayRepo: 'https://mp-force.ziti.uni-heidelberg.de/asc/infrastructure/vcpkg-ports.git'
  vcpkgPortsOverlayRef: c19ffbe03fd152a92bbbb70e68805087d2b98aef
  vcpkgTripletSuffix: ''
  cmakeBaseConfigArgs: '-DSLOWMATH_BUILD_TESTS=ON'
  cmakeSanitizeConfigArgs: '-DCMAKESHIFT_PRIVATE_COMPILE_SETTINGS=runtime-checks;debug-stdlib'
  cmakeConfigArgs: '$(cmakeBaseConfigArgs)'
  revision: 4

trigger:
- master
- mr/*

pr:
- master

jobs:
  - job: Windows

    strategy:
      matrix: 
        MSVC_Debug_x86:
          Config: Debug
          Platform: x86
          Compiler: MSVC
        MSVC_Release_x86:
          Config: RelWithDebInfo
          Platform: x86
          Compiler: MSVC
        MSVC_Debug_x64:
          Config: Debug
          Platform: x64
          Compiler: MSVC
        MSVC_Release_x64:
          Config: RelWithDebInfo
          Platform: x64
          Compiler: MSVC
        #Clang_Debug_x86:
        #  Config: Debug
        #  Platform: x86
        #  Compiler: Clang
        #Clang_Release_x86:
        #  Config: RelWithDebInfo
        #  Platform: x86
        #  Compiler: Clang
        #Clang_Debug_x64:
        #  Config: Debug
        #  Platform: x64
        #  Compiler: Clang
        #Clang_Release_x64:
        #  Config: RelWithDebInfo
        #  Platform: x64
        #  Compiler: Clang

    pool:
      name: Azure Pipelines
      vmImage: 'windows-2019'

    steps:
      - template: azure-pipelines-windows.yml

  - job: Ubuntu

    variables:
        vcpkgTripletSuffix: '-sanitize'

    strategy:
      matrix: 
        GCC_Debug:
          Config: Debug
          Platform: x64
          Compiler: GCC
        GCC_Release:
          Config: RelWithDebInfo
          Platform: x64
          Compiler: GCC
        Clang_Debug:
          Config: Debug
          Platform: x64
          Compiler: Clang
        Clang_Release:
          Config: RelWithDebInfo
          Platform: x64
          Compiler: Clang

    pool:
      name: Azure Pipelines
      vmImage: 'ubuntu-18.04'

    steps:
      - template: azure-pipelines-linux.yml

  - job: MacOS

    strategy:
      matrix: 
        GCC_Debug:
          Config: Debug
          Platform: x64
          Compiler: GCC
        GCC_Release:
          Config: RelWithDebInfo
          Platform: x64
          Compiler: GCC
        AppleClang_Debug:
          Config: Debug
          Platform: x64
          Compiler: Clang
        AppleClang_Release:
          Config: RelWithDebInfo
          Platform: x64
          Compiler: Clang

    pool:
      name: Azure Pipelines
      vmImage: 'macOS-10.14'
      
    steps:
      - template: azure-pipelines-macos.yml
